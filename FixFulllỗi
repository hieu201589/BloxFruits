-- Tạo GUI đơn giản để hiển thị FPS
local screenGui = Instance.new("ScreenGui")
screenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

local fpsLabel = Instance.new("TextLabel")
fpsLabel.Size = UDim2.new(0, 200, 0, 50)
fpsLabel.Position = UDim2.new(0, 10, 0, 10)
fpsLabel.BackgroundTransparency = 0.5
fpsLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
fpsLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
fpsLabel.TextSize = 10  -- Kích thước văn bản là 10
fpsLabel.Text = "FPS: 0"
fpsLabel.Parent = screenGui

-- Biến lưu thời gian
local lastUpdateTime = tick()
local frameCount = 0
local fps = 0

-- Hàm tính FPS và thay đổi màu sắc của FPS
local function updateFPS()
    local currentTime = tick()
    frameCount = frameCount + 1
    -- Mỗi giây, tính lại FPS và hiển thị trên GUI
    if currentTime - lastUpdateTime >= 1 then
        fps = frameCount
        fpsLabel.Text = "FPS: " .. fps

        -- Chọn màu sắc dựa trên FPS
        if fps < 10 then
            fpsLabel.TextColor3 = Color3.fromRGB(255, 0, 0)   -- Đỏ (FPS rất thấp)
        elseif fps < 20 then
            fpsLabel.TextColor3 = Color3.fromRGB(255, 69, 0)  -- Cam
        elseif fps < 30 then
            fpsLabel.TextColor3 = Color3.fromRGB(255, 255, 0) -- Vàng
        elseif fps < 40 then
            fpsLabel.TextColor3 = Color3.fromRGB(154, 205, 50) -- Lục nhạt
        elseif fps < 50 then
            fpsLabel.TextColor3 = Color3.fromRGB(0, 255, 0)   -- Xanh lá cây
        elseif fps < 60 then
            fpsLabel.TextColor3 = Color3.fromRGB(0, 0, 255)   -- Xanh dương
        else
            fpsLabel.TextColor3 = Color3.fromRGB(138, 43, 226) -- Tím (FPS cao nhất)
        end

        lastUpdateTime = currentTime
        frameCount = 0
    end
end

-- Giảm chất lượng đồ họa
game:GetService("Players").LocalPlayer.PlayerSettings.SavedQualityLevel = Enum.QualityLevel.Level1

-- Tắt các hiệu ứng ánh sáng và bóng không cần thiết
game:GetService("Lighting").GlobalShadows = false
game:GetService("Lighting").Bloom.Enabled = false
game:GetService("Lighting").SunRays.Enabled = false
game:GetService("Lighting").LensFlare.Enabled = false
game:GetService("Lighting").ColorCorrection.Enabled = false
game:GetService("Lighting").ShadowQuality = Enum.ShadowQuality.NoShadows

-- Tắt V-Sync và FPS limiter
if game:GetService("UserSettings"):GetService("GameSettings").VSyncEnabled then
    game:GetService("UserSettings"):GetService("GameSettings").VSyncEnabled = false
end

-- Tối ưu hóa RemoteEvent/RemoteFunction
local RemoteEvent = game.ReplicatedStorage:WaitForChild("YourRemoteEvent")

-- Thêm một thời gian delay hợp lý giữa các sự kiện để tránh gửi quá nhiều dữ liệu
RemoteEvent.OnClientEvent:Connect(function(data)
    wait(0.1)  -- Chờ 100ms giữa các sự kiện để giảm tải mạng
    -- Xử lý dữ liệu nhận được tại đây
end)

-- Giảm đồng bộ hóa không cần thiết
game:GetService("Players").PlayerAdded:Connect(function(player)
    -- Cập nhật các cài đặt mạng cho mỗi người chơi
    local playerCharacter = player.Character or player.CharacterAdded:Wait()
    local humanoid = playerCharacter:WaitForChild("Humanoid")
    
    -- Hạn chế các đối tượng được đồng bộ hóa với Server
    humanoid.PlatformStand = true  -- Tắt các hiệu ứng không cần thiết

    -- Chỉ đồng bộ hóa các đối tượng quan trọng
    if player.Character:FindFirstChild("HumanoidRootPart") then
        local hrp = player.Character.HumanoidRootPart
        hrp.Anchored = false  -- Tránh việc đồng bộ hóa trạng thái quá nhiều
    end
end)

-- Kiểm tra và giảm số lượng đối tượng được đồng bộ hóa giữa Client và Server
game:GetService("RunService").Heartbeat:Connect(function()
    -- Giảm các đối tượng đang xử lý trên Server, chỉ xử lý những đối tượng quan trọng
    for _, object in pairs(workspace:GetChildren()) do
        if object:IsA("Model") or object:IsA("Part") then
            -- Loại bỏ các đối tượng không cần thiết, không cần thiết phải đồng bộ hóa
            if (object.Position - game.Players.LocalPlayer.Character.HumanoidRootPart.Position).Magnitude > 500 then
                object:Destroy()  -- Xóa các đối tượng xa người chơi
            end
        end
    end
end)

-- Giảm tải Ping bằng cách giảm các tác vụ không cần thiết trên Client và Server
game:GetService("RunService").Heartbeat:Connect(function()
    -- Giảm tải xử lý đồ họa, giảm bớt các phép toán phức tạp trong mỗi frame
    -- Tránh vòng lặp chạy quá nhanh
    wait(0.05)  -- Tăng thời gian chờ giữa mỗi lần cập nhật trạng thái (Giảm tần suất gửi dữ liệu mạng)
end)

-- Kiểm tra tình trạng tối ưu hóa ping, thông qua số lượng đối tượng
function checkPingOptimization()
    local objectCount = #workspace:GetChildren()
    print("Current object count in workspace: " .. objectCount)
    
    if objectCount > 500 then
        print("Warning: Too many objects in the workspace!")
    else
        print("Object count is within optimal range.")
    end
end

checkPingOptimization()  -- Kiểm tra tình trạng tối ưu hóa

-- Giảm kích thước của các đối tượng lớn
for _, part in pairs(workspace:GetDescendants()) do
    if part:IsA("Part") then
        part.Size = part.Size / 2  -- Giảm kích thước
    end
end

-- Giảm bớt các đối tượng nhân vật (Xóa phụ kiện không cần thiết)
game:GetService("Players").PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function(character)
        -- Xóa các phụ kiện không cần thiết
        for _, accessory in pairs(character:GetChildren()) do
            if accessory:IsA("Accessory") then
                accessory:Destroy() -- Xóa phụ kiện không cần thiết
            end
        end
    end)
end)
